# 演習1-2: 言語化演習 回答

## Q1: Server Component がデフォルトである理由

**バンドルサイズの観点:**
ページを表示する際のデータ取得であったり、アイコンや画像やそのページのロジックで使われているライブラリなどはサーバー側で管理することになるので、クライアント側で管理しているスクリプトの量、つまりバンドルサイズは抑えることができます。なので基本的にはNext.jsにおいてサーバーコンポーネントがデフォルトになります。

**セキュリティの観点:**
機密情報を安全に扱える点でサーバーコンポーネントはクライアントコンポーネントよりも優れています。
例えば、アプリケーションのロジックの中に機密情報、例えばAPIキーなどが含まれていたとして、そうした情報は基本的にはサーバー側で利用することがセキュアです。クライアント側にそうした機密情報を共有することはセキュリティ上好ましくありません。APIキーの漏洩などにつながるからです。なので、基本的にはセキュリティの観点を考えて、サーバーコンポーネントがデフォルトになっています。

**データアクセスの観点:**
基本的にはサーバー側でデータを取得しておいた方が、クライアント側でブラウザからHTTPリクエストをしてデータを取ってくるという負担がなくなるので、そうしたクライアントの負荷を軽減するという意味、サーバーコンポーネント側でデータを取得することの方が好ましいです。
また、パフォーマンスの観点からもサーバー側でデータ取得をした方が良いです。基本的にDBであったり、外部のAPIといったものはクライアント側からアクセスすると物理的に距離があるため時間がかかります。対してサーバー側でアクセスすると、DBなどは基本的には同じサーバーが所属するネットワークに属してることが多いので、データ取得の時間が短くパフォーマンスの点で優れています。

### 一点だけ補足として考えてみてほしいことがあります。データアクセスの観点で「クライアント側のHTTPリクエストの負担がなくなる」と書いていますが、Server Componentではそもそも APIエンドポイントを用意せずに直接DBやファイルシステムにアクセスできます。これは単に「負担が減る」以上の意味がありますが、その利点は何だと思いますか？
セキュリティの観点になりますが、そもそもエンドポイントを用意する必要がないので、外部にリソースを公開することがないため、悪意を持ったユーザーからAPIを経由した何か悪さをされるというリスクがそもそもない点ですかね。

---

## Q2: "use client" の判断基準

| # | ケース | Server / Client | 理由 |
|---|--------|----------------|------|
| 1 | ユーザー一覧をDBから取得して表示 | Server | 単純にDBからデータを取得するだけなので、ブラウザの機能を使わないため、use clientを使う必要はありません。 |
| 2 | いいねボタン | Client | いいねボタンはユーザーのクリックイベントに反応してカウントアップする機能になりますので、ボタンを用意してそのクリックイベントに応じてステートで管理した値を更新する制御が必要になっているので、ブラウザの機能を使う必要があるため、こちらは"use client"を使う必要があります。 |
| 3 | 現在の日時を表示（サーバー側で取得） | Server | 1と同じくブラウザの機能を使う必要はなく、ただ単純にサーバーから日時を取得して表示するだけなので、"use client"を使う必要はないです。 |
| 4 | フォームのリアルタイムバリデーション | Client | 2と同じく、ユーザーの入力に応じてステートの制御が必要になる。具体的には、エラーメッセージをステートで管理すると思うんですけど、そういった処理をリアルタイムで実施するためにはクライアントコンポーネントを使う必要があるので、「use client」の宣言が必要になります。 |
| 5 | searchParamsで検索結果を表示 | Server | こちらも1と同じように、単純にDBから検索して結果を表示するだけになるので、何かブラウザの機能を使うわけでもないですし、ステート管理が必要なわけでもないので、use clientを使う必要はありません。 |

---

## Q3: props の制約

**関数を渡せない理由:**
サーバー側で定義した関数をクライアント側で復元することが技術的に難しいからです。その理由としては3点ほどあり、まず1点目が関数というのは普通の文字列であったり数値といった純粋なデータではなくて、その関数が定義された実行環境、つまりコンテキストの情報をセットとする構造的なデータになります。その構造的なデータ一度シリアライズ（JSON化）し、また、クライアント側で復元するのが難しいです。2点目がサーバー側で定義した関数の中にサーバー側でしかできない処理、例えばファイルシステムにアクセスしたり、サーバー側の特有のAPIを実行したりする場合、それをクライアント側で復元できないですよね。3点目がセキュリティですね。もしサーバー側で定義した関数をクライアントで復元して実行するとなると、これはXSS攻撃の温床になってしまいます。クライアント側で仮にサーバー側で送られてきた関数のサニタイズをしますとなったとして、じゃあどういう関数が安全か安全じゃないかみたいな判別がほぼ不可能です。以上の理由からサーバー側で定義した関数をクライアントコンポーネントに渡す、プロップスとして渡すことができないです。
