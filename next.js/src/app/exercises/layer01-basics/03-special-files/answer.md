# 演習1-3: 言語化演習 回答

## Q1: 特殊ファイルの発火条件

| ファイル | いつ表示される？ | 内部的に何が起きている？ |
|---------|-----------------|----------------------|
| `loading.tsx` | そのファイルが配置されているプロジェクト配下のコンポーネントにおいて、表示できる準備が整っていない間に表示されます。 | 内部的にReactのSuspenseの機能を使っていて、こちらのファイルが置かれたプロジェクトの配下のコンポーネントがスローするPromiseを受け取って、それを検知したタイミングでフォールバックとしてloading.tsxのコンポーネントを表示します。 |
| `error.tsx` | そのファイルが配置されているプロジェクト配下のコンポーネントにおいて、何かしらのエラーがスローされたときです。 | このファイルが配置されているプロジェクト配下のコンポーネントにおいて、スローされたエラーをError Boundaryがキャッチし、そのフォールバックとして表示するコンポーネントとして、error.tsxの内容が表示されます。 |
| `not-found.tsx` | notFound() という関数呼び出した時。また、App直下に配置した場合は、存在しないURLのアクセス時にも表示されます。 | NotFound()という関数が実行されると、それを識別するような例外がthrowされて、Next.jsが独自で管理しているラッパーコンポーネントがそれをキャッチして、not-found.tsxのコンポーネントを表示しているイメージです。 |

> **レビュー（Q1）:**
> loading.tsx と error.tsx の説明は的確です。内部メカニズム（Suspense / Error Boundary）まで言及できているのが良いですね。
>
> not-found.tsx について1点確認です。`notFound()` を呼んだ場合に表示されるのは正しいですが、**それ以外に not-found.tsx が表示されるケースはありませんか？** たとえば、存在しないURLに直接アクセスした場合はどうなるでしょう？
>
> **最終レビュー（Q1）:** 合格です。not-found.tsx の追加ケース（App直下に配置した場合、存在しないURLのアクセス時にも表示される）を正しく補完できました。



---

## Q2: loading.tsx と Suspense の関係

**loading.tsx が内部的に使っている React の機能:**
Suspense

**loading.tsx を使う場合と直接その機能を使う場合の違い:**
Loading.tsxと上で挙げたSuspenseは、適用範囲に明確な違いがあります。loading.tsxは、そのファイルを配置したセグメント配下すべてのコンポーネントに対してローディング制御が適用されるのに対して、Suspenseはコンポーネント単位、つまりラップしたコンポーネントに対してローディング制御が行われます。それはUXの違いになって現れると思います。loading.tsxの場合は、全てのコンポーネントがレディになった状態で画面が表示されるのに対して、Suspenseの場合は、準備ができたコンポーネントからどんどん表示されるようになるので、UX的にはSuspenseで細かくローディング制御してあげた方が、退屈しにくいUIになると思います。

> **レビュー（Q2）:**
> Suspenseを正しく特定できています。適用範囲の違い（セグメント全体 vs コンポーネント単位）の説明と、UXへの影響まで言及しているのが素晴らしいです。
>
> 1点だけ補足すると、loading.tsx が Suspense で包むのは **そのセグメントの `page.tsx`（と子セグメント）** であり、**同じディレクトリの `layout.tsx` は Suspense の対象外** です。この点は Q3 の error.tsx の話とも構造的に共通するポイントですね。

---

## Q3: error.tsx の制約

**同じディレクトリの layout.tsx のエラーをキャッチできない理由:**
error.tsxってReactの中でエラーバウンダリーみたいな機能を持つと思っています。layout.tsxと同じディレクトリにerror.tsxを配置する場合、おそらくReactツリー上ではまずlayoutっていう枠組みの中にエラーバウンダリーが配置されているイメージになるので、当然そのエラーバウンダリーの中でキャッチできるエラーっていうのは、エラーバウンダリーでラップされているコンポーネントっていうのはReactツリー、このツリーになると思うので、そう考えるとlayout.tsx内で定義されている処理によるエラーはエラーバウンダリーの守備外になるので、エラーをキャッチできないんじゃないかなと考えています。

> **レビュー（Q3）:**
> 正確です。レンダリングツリーの構造を正しく理解しています。
>
> 整理すると: `layout.tsx` → `error.tsx (Error Boundary)` → `page.tsx` という入れ子構造になるため、Error Boundary より**上位**にある layout のエラーは捕捉できない、ということですね。では、もし layout.tsx のエラーもキャッチしたい場合はどうすればよいか、考えてみてもいいかもしれません（ヒント: 親セグメント）。
